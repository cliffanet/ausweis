#!/usr/bin/perl

package main;

our $rRead      = 'r';
our $rWrite     = 'w';
our $rYes       = 'y';
our $rMy        = 'm';
our $rAdvanced  = 'a';
our $rAll       = 'z';
our $rAdd       = 'c',

our $rMain              = 1;
our $rAdmins            = 2;
our $rBlokList          = 11;
our $rBlokInfo          = 12;
our $rBlokEdit          = 13;
our $rCommandList       = 21;
our $rCommandInfo       = 22;
our $rCommandEdit       = 23;
our $rCommandLogo       = 24;
our $rAusweisList       = 31;
our $rAusweisInfo       = 32;
our $rAusweisEdit       = 33;
our $rAusweisPreEdit    = 34;
our $rPrint             = 40;
our $rPrintAusweis      = 41;
our $rEvent             = 45;
our $rPreedit           = 50;

package rights;


our %types = (
    $::rRead    => "Чтение",
    $::rWrite   => "Изменение",
    $::rYes     => "Да",
    $::rMy      => "Только свое",
    $::rAdvanced=> "Расширенный",
    $::rAll     => "Все",
    $::rAdd     => "Добавление",
    '-'         => "Нет",
    'g'         => "Как у группы",
);

our @list = (
    [$::rMain,                  "Глобальный доступ",                    [$::rYes]],
    [$::rAdmins,                "Аккаунты",                             [$::rRead, $::rWrite]],
    undef,
    [$::rBlokList,              "Блоки: список",                        [$::rRead]],
    [$::rBlokInfo,              "Блоки: информация",                    [$::rMy, $::rAll]],
    [$::rBlokEdit,              "Блоки: редактирование",                [$::rMy, $::rAll]],
    [$::rCommandList,           "Команды: список",                      [$::rRead]],
    [$::rCommandInfo,           "Команды: информация",                  [$::rMy, $::rAll]],
    [$::rCommandEdit,           "Команды: редактирование",              [$::rMy, $::rAll]],
    [$::rCommandLogo,           "Команды: загрузка логотипа",           [$::rMy, $::rAll]],
    [$::rAusweisList,           "Аусвайсы: список",                     [$::rRead]],
    [$::rAusweisInfo,           "Аусвайсы: информация",                 [$::rMy, $::rAll]],
    [$::rAusweisEdit,           "Аусвайсы: редактирование",             [$::rMy, $::rAll]],
    [$::rAusweisPreEdit,        "Аусвайсы: запрос на изменение",        [$::rMy, $::rAll]],
    undef,
    [$::rPrint,                 "Печать",                               [$::rRead, $::rWrite]],
    [$::rPrintAusweis,          "Печать: работа с аусвайсами",          [$::rMy, $::rAll]],
    [$::rPreedit,               "Модерация изменений в базе",           [$::rYes]],
    [$::rEvent,                 "Мероприятия",                          [$::rRead, $::rWrite]],
);


our @AdminMenu = (
    [
        'Администрирование',
        [ 'Аккаунты',           sub { shift->d->{admin}->{href_list} },
                                sub { $_[0]->rights_exists($rAdmins) } ],
        [ 'Группы',             sub { shift->d->{admin_group}->{href_list} },
                                sub { $_[0]->rights_exists($rAdmins) } ],
        undef,
        [ 'Печать',             sub { shift->href($::disp{PrintList}) },
                                sub { $_[0]->rights_exists($rPrint) } ],
        [ 'Модерация',          sub { shift->href($::disp{PreeditShowItem}) },
                                sub { $_[0]->rights_exists($rPreedit) } ],
        [ 'Мероприятия',        sub { shift->href($::disp{EventList}) },
                                sub { $_[0]->rights_exists($rEvent) } ],
    ],
    [
        'Аусвайсы',
        [ 'Блоки',              sub { shift->href($::disp{BlokList}) },
                                sub { $_[0]->rights_exists($rBlokList) } ],
        [ 'Команды',            sub { shift->href($::disp{CommandList}) },
                                sub { $_[0]->rights_exists($rCommandList) } ],
        [ 'Аусвайсы',           sub { shift->href($::disp{AusweisList}) },
                                sub { $_[0]->rights_exists($rAusweisList) } ],
        [ 'Моя команда',        sub { shift->href($::disp{CommandShowMy}, 'info') },
                                sub { $_[0]->rights_check($rCommandInfo, $rMy, $rAll) } ],
        undef,
        [ 'Добавить аусвайс',   sub { shift->href($::disp{AusweisAdding}) },
                                sub { $_[0]->rights_check($rAusweisEdit, $rAll) } ],
    ],
);


1;